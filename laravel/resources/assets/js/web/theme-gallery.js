;(function(window){'use strict';if(!window.Modernizr){return;}
var support={transitions:Modernizr.csstransitions},transEndEventNames={'WebkitTransition':'webkitTransitionEnd','MozTransition':'transitionend','OTransition':'oTransitionEnd','msTransition':'MSTransitionEnd','transition':'transitionend'},transEndEventName=transEndEventNames[Modernizr.prefixed('transition')],onEndTransition=function(el,callback){var onEndCallbackFn=function(e){if(support.transitions){if(e.target!=this){return;}
this.removeEventListener(transEndEventName,onEndCallbackFn);}
if(callback&&typeof callback==='function'){callback.call(this);}};if(support.transitions){el.addEventListener(transEndEventName,onEndCallbackFn);}else{onEndCallbackFn();}};function throttle(fn,delay){var allowSample=true;return function(e){if(allowSample){allowSample=false;setTimeout(function(){allowSample=true;},delay);fn(e);}};}
function nextSibling(el){var nextSibling=el.nextSibling;while(nextSibling&&nextSibling.nodeType!=1){nextSibling=nextSibling.nextSibling}
return nextSibling;}
function extend(a,b){for(var key in b){if(b.hasOwnProperty(key)){a[key]=b[key];}}
return a;}
function GalleryFx(el,options){this.galleryEl=el;this.options=extend({},this.options);extend(this.options,options);this.items=[].slice.call(this.galleryEl.querySelectorAll('.post_layout_gallery'));if(jQuery(this.galleryEl).next('.gallery_preview').length==0){jQuery(this.galleryEl).after('<div class="gallery_preview'+(this.options.previewClass?' '+this.options.previewClass:'')+'">\
				<a href="#" class="gallery_preview_close icon-cancel"></a>\
				<div class="gallery_preview_description"></div>\
			</div>');}
this.previewEl=nextSibling(this.galleryEl);this.isExpanded=false;this.isAnimating=false;this.closeCtrl=this.previewEl.querySelector('.gallery_preview_close');this.previewDescriptionEl=this.previewEl.querySelector('.gallery_preview_description');this._init();}
GalleryFx.prototype.options={pagemargin:0,imgPosition:{x:1,y:1},previewClass:'',onInit:function(instance){return false;},onResize:function(instance){return false;},onOpenItem:function(instance,item){return false;},onCloseItem:function(instance,item){return false;},onExpand:function(){return false;}}
GalleryFx.prototype._init=function(){this.options.onInit(this);var self=this;blabber_when_images_loaded(jQuery(this.galleryEl),function(){self._initEvents();self._setOriginal();self._setClone();});};GalleryFx.prototype.appendItems=function(){this.items=[].slice.call(this.galleryEl.querySelectorAll('.post_layout_gallery'));this._initEvents();};GalleryFx.prototype._initEvents=function(){var self=this,clickEvent=(document.ontouchstart!==null?'click':'touchstart');this.items.forEach(function(item){if(classie.has(item,'inited')){return;}
classie.add(item,'inited');var touchend=function(e){e.preventDefault();self._openItem(e,item);item.removeEventListener('touchend',touchend);},touchmove=function(e){item.removeEventListener('touchend',touchend);},manageTouch=function(){item.addEventListener('touchend',touchend);item.addEventListener('touchmove',touchmove);};item.addEventListener(clickEvent,function(e){if(clickEvent==='click'){e.preventDefault();self._openItem(e,item);}else{manageTouch();}});});this.closeCtrl.addEventListener('click',function(e){self._closeItem();e.preventDefault();return false;});window.addEventListener('resize',throttle(function(e){self.options.onResize(self);},10));}
GalleryFx.prototype._openItem=function(ev,item){if(this.isAnimating||this.isExpanded){return;}
this.isAnimating=true;this.isExpanded=true;var galleryImg=item.querySelector('img'),galleryImgOffset=galleryImg.getBoundingClientRect();this.current=this.items.indexOf(item);this._setOriginal(item.getAttribute('data-src'));this.options.onOpenItem(this,item);this._setClone(galleryImg.src,{width:galleryImg.offsetWidth,height:galleryImg.offsetHeight,left:galleryImgOffset.left,top:galleryImgOffset.top});classie.add(item,'gallery_item_current');var win=this._getWinSize(),originalSizeArr=item.getAttribute('data-size').split('x'),originalSize={width:originalSizeArr[0],height:originalSizeArr[1]},dx=((this.options.imgPosition.x>0?1-Math.abs(this.options.imgPosition.x):Math.abs(this.options.imgPosition.x))*win.width+this.options.imgPosition.x*win.width/2)-galleryImgOffset.left-0.5*galleryImg.offsetWidth,dy=((this.options.imgPosition.y>0?1-Math.abs(this.options.imgPosition.y):Math.abs(this.options.imgPosition.y))*win.height+this.options.imgPosition.y*win.height/2)-galleryImgOffset.top-0.5*galleryImg.offsetHeight,z=Math.min(Math.min(win.width*Math.abs(this.options.imgPosition.x)-this.options.pagemargin,originalSize.width-this.options.pagemargin)/galleryImg.offsetWidth,Math.min(win.height*Math.abs(this.options.imgPosition.y)-this.options.pagemargin,originalSize.height-this.options.pagemargin)/galleryImg.offsetHeight);this.cloneImg.style.WebkitTransform='translate3d('+dx+'px, '+dy+'px, 0) scale3d('+z+', '+z+', 1)';this.cloneImg.style.transform='translate3d('+dx+'px, '+dy+'px, 0) scale3d('+z+', '+z+', 1)';var descriptionEl=item.querySelector('.post_details');if(descriptionEl){this.previewDescriptionEl.innerHTML=descriptionEl.innerHTML;}
var self=this;setTimeout(function(){classie.add(self.previewEl,'gallery_preview_show');self.options.onExpand();},0);onEndTransition(this.cloneImg,function(){imagesLoaded(self.originalImg,function(){classie.add(self.previewEl,'gallery_preview_image_loaded');self.originalImg.style.opacity=1;onEndTransition(self.originalImg,function(){self.cloneImg.style.opacity=0;self.cloneImg.style.WebkitTransform='translate3d(0,0,0) scale3d(1,1,1)';self.cloneImg.style.transform='translate3d(0,0,0) scale3d(1,1,1)';self.isAnimating=false;});});});};GalleryFx.prototype._setOriginal=function(src){if(!src){this.originalImg=document.createElement('img');this.originalImg.className='gallery_preview_image_original';this.originalImg.style.opacity=0;this.originalImg.style.maxWidth='calc('+parseInt(Math.abs(this.options.imgPosition.x)*100)+'vw - '+this.options.pagemargin+'px)';this.originalImg.style.maxHeight='calc('+parseInt(Math.abs(this.options.imgPosition.y)*100)+'vh - '+this.options.pagemargin+'px)';this.originalImg.style.WebkitTransform='translate3d(0,0,0) scale3d(1,1,1)';this.originalImg.style.transform='translate3d(0,0,0) scale3d(1,1,1)';src='';this.previewEl.appendChild(this.originalImg);}
this.originalImg.setAttribute('src',src);};GalleryFx.prototype._setClone=function(src,settings){if(!src){this.cloneImg=document.createElement('img');this.cloneImg.className='gallery_preview_image_clone';src='';this.cloneImg.style.opacity=0;this.previewEl.appendChild(this.cloneImg);}else{this.cloneImg.style.opacity=1;this.cloneImg.style.width=settings.width+'px';this.cloneImg.style.height=settings.height+'px';this.cloneImg.style.top=settings.top+'px';this.cloneImg.style.left=settings.left+'px';}
this.cloneImg.setAttribute('src',src);};GalleryFx.prototype._closeItem=function(){if(!this.isExpanded||this.isAnimating){return;}
this.isExpanded=false;this.isAnimating=true;var galleryItem=this.items[this.current],galleryImg=galleryItem.querySelector('img'),galleryImgOffset=galleryImg.getBoundingClientRect(),self=this;classie.remove(this.previewEl,'gallery_preview_show');classie.remove(this.previewEl,'gallery_preview_image_loaded');this.options.onCloseItem(this,galleryItem);classie.add(this.originalImg,'gallery_preview_image_animate');var win=this._getWinSize(),dx=galleryImgOffset.left+galleryImg.offsetWidth/2-((this.options.imgPosition.x>0?1-Math.abs(this.options.imgPosition.x):Math.abs(this.options.imgPosition.x))*win.width+this.options.imgPosition.x*win.width/2),dy=galleryImgOffset.top+galleryImg.offsetHeight/2-((this.options.imgPosition.y>0?1-Math.abs(this.options.imgPosition.y):Math.abs(this.options.imgPosition.y))*win.height+this.options.imgPosition.y*win.height/2),z=galleryImg.offsetWidth/this.originalImg.offsetWidth;this.originalImg.style.WebkitTransform='translate3d('+dx+'px, '+dy+'px, 0) scale3d('+z+', '+z+', 1)';this.originalImg.style.transform='translate3d('+dx+'px, '+dy+'px, 0) scale3d('+z+', '+z+', 1)';onEndTransition(this.originalImg,function(){self.previewDescriptionEl.innerHTML='';classie.remove(galleryItem,'gallery_item_current');setTimeout(function(){self.originalImg.style.opacity=0;},60);onEndTransition(self.originalImg,function(){classie.remove(self.originalImg,'animate');self.originalImg.style.WebkitTransform='translate3d(0,0,0) scale3d(1,1,1)';self.originalImg.style.transform='translate3d(0,0,0) scale3d(1,1,1)';self.isAnimating=false;});});};GalleryFx.prototype._getWinSize=function(){return{width:document.documentElement.clientWidth,height:window.innerHeight};};window.GalleryFx=GalleryFx;jQuery(document).on('action.init_hidden_elements',function(e,cont){if(cont===undefined)cont=jQuery('body');cont.find('.masonry_wrap').each(function(){var portfolio=jQuery(this);if(portfolio.parents('div:hidden,article:hidden').length>0){return;}
if(!portfolio.hasClass('inited')){if(!portfolio.hasClass('gallery_wrap')){portfolio.addClass('inited');}
var portfolio_dom=portfolio.get(0);blabber_when_images_loaded(portfolio,function(){var selector=portfolio.hasClass('gallery')?'.gallery-item':'.masonry_item';portfolio.masonry({itemSelector:selector,columnWidth:selector,percentPosition:true});jQuery(window).trigger('resize');});}else{setTimeout(function(){portfolio.masonry();},310);}});var support={transitions:Modernizr.csstransitions},transEndEventNames={'WebkitTransition':'webkitTransitionEnd','MozTransition':'transitionend','OTransition':'oTransitionEnd','msTransition':'MSTransitionEnd','transition':'transitionend'},transEndEventName=transEndEventNames[Modernizr.prefixed('transition')],onEndTransition=function(el,callback){var onEndCallbackFn=function(e){if(support.transitions){if(e.target!=this){return;}
this.removeEventListener(transEndEventName,onEndCallbackFn);}
if(callback&&typeof callback==='function'){callback.call(this);}};if(support.transitions){el.addEventListener(transEndEventName,onEndCallbackFn);}else{onEndCallbackFn();}};cont.find('.gallery_wrap:not(.inited)').each(function(idx){if(jQuery(this).parents('div:hidden,article:hidden').length>0){return;}
if(!BLABBER_STORAGE['GalleryFx']){BLABBER_STORAGE['GalleryFx']={};}
var id=jQuery(this).addClass('inited').attr('id');if(id==undefined){id='gallery_fx_'+Math.random();id=id.replace('.','');jQuery(this).attr('id',id);}
BLABBER_STORAGE['GalleryFx'][id]=new GalleryFx(this,{previewClass:'scheme_dark',imgPosition:{x:-0.5,y:1},onOpenItem:function(instance,item){instance.items.forEach(function(el){if(item!=el){var delay=Math.floor(Math.random()*50);el.style.WebkitTransition='opacity .5s '+delay+'ms cubic-bezier(.7,0,.3,1), -webkit-transform .5s '+delay+'ms cubic-bezier(.7,0,.3,1)';el.style.transition='opacity .5s '+delay+'ms cubic-bezier(.7,0,.3,1), transform .5s '+delay+'ms cubic-bezier(.7,0,.3,1)';el.style.WebkitTransform='scale3d(0.1,0.1,1)';el.style.transform='scale3d(0.1,0.1,1)';el.style.opacity=0;}});},onCloseItem:function(instance,item){instance.items.forEach(function(el){if(item!=el){el.style.WebkitTransition='opacity .4s, -webkit-transform .4s';el.style.transition='opacity .4s, transform .4s';el.style.WebkitTransform='scale3d(1,1,1)';el.style.transform='scale3d(1,1,1)';el.style.opacity=1;onEndTransition(el,function(){el.style.transition='none';el.style.WebkitTransform='none';});}});},onExpand:function(){var content=jQuery('.gallery_preview');if(content.length>0){content.find('.inited').removeClass('inited');jQuery(document).trigger('action.init_hidden_elements',[content]);}}});});});})(window);